<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактор сценариев - VNE</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="creator-body">
    <div class="creator-container">
        <div class="creator-header">
            <h1>Редактор сценариев</h1>
            <div>
                <a href="/" class="btn btn--secondary">Главное меню</a>
            </div>
        </div>

        <div class="creator-card controls-card">
            <div class="creator-card-content">
                <h3>Управление сценарием</h3>
                <div class="controls-wrapper">
                    <button class="btn btn--primary" id="save-scenario-btn">Сохранить сценарий</button>
                    <select id="load-scenario-select" class="form-control" style="min-width: 200px;">
                        <option value="">-- Загрузить сценарий --</option>
                    </select>
                    <button class="btn btn--secondary" id="load-scenario-btn">Загрузить</button>
                    <button class="btn btn--secondary" id="new-scenario-btn">Новый сценарий</button>
                </div>
                <div class="controls-wrapper" style="margin-top: 10px; gap: 10px;">
                    <button class="btn btn--secondary" id="export-scenario-btn">Скачать сценарий</button>
                    <input type="file" id="import-scenario-input" accept=".json" style="display: none;">
                    <button class="btn btn--secondary" id="import-scenario-btn">Импортировать сценарий</button>
                </div>
            </div>
        </div>

        <div class="creator-card">
            <h3>Данные сценария</h3>
            <br>
            <div class="grid">
                <div class="form-group">
                    <label for="scenario-id">ID Сценария</label>
                    <input type="text" id="scenario-id" placeholder="my_scenario">
                </div>
                <div class="form-group">
                    <label for="scenario-title">Название</label>
                    <input type="text" id="scenario-title" placeholder="Название истории">
                </div>
                <div class="form-group">
                    <label for="scenario-description">Описание</label>
                    <input type="text" id="scenario-description" placeholder="Краткое описание сюжета">
                </div>
                 <div class="form-group">
                    <label for="scenario-author">Автор</label>
                    <input type="text" id="scenario-author" placeholder="Ваш никнейм">
                </div>
            </div>
        </div>
        <br>

        <div id="dialogue-cards-container"></div>
        <div class="add-dialogue-wrapper">
            <button class="btn btn--primary" id="add-dialogue-btn">Добавить реплику</button>
        </div>
    </div>

    <template id="dialogue-card-template">
        <div class="card dialogue-card">
            <button class="btn btn--danger btn--small remove-dialogue-btn">Удалить</button>
            <h3>Реплика: <span class="dialogue-id-display"></span></h3>
            <br>
            <div class="grid">
                <div class="form-group">
                    <label>ID Реплики (латиница)</label>
                    <input type="text" class="dialogue-id-input" placeholder="replic_id">
                </div>
                <div class="form-group">
                    <label>Фон (Сцена)</label>
                    <select class="scene-select"><option value="">-- Не менять --</option></select>
                </div>
                <div class="form-group">
                    <label>Говорящий персонаж</label>
                    <select class="speaker-select"><option value="">-- Рассказчик --</option></select>
                </div>
                <div class="form-group">
                    <label>ID Следующей реплики</label>
                    <select class="next-dialogue-select"><option value="">-- Не выбрано --</option></select>
                </div>
            </div>
            <div class="form-group">
                <label>Текст реплики</label>
                <textarea class="dialogue-text-input" rows="3"></textarea>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Условие показа реплики (например, trust > 5)</label>
                    <input type="text" class="dialogue-condition-input" placeholder="sample_variable == true">
                </div>
                <div class="form-group">
                    <label>ID реплики, если условие НЕ выполнено</label>
                    <select class="next-if-false-select"><option value="">-- Перейти к 'ID Следующей реплики' --</option></select>
                </div>
            </div>
            
            <div class="characters-section">
                <div class="characters-header">
                    <h4>Персонажи на сцене</h4>
                    <button class="btn btn--small btn--secondary add-character-btn" type="button">Добавить персонажа</button>
                </div>
                <div class="characters-slots-container">
                    <!-- Character slots will be dynamically added here -->
                </div>
            </div>

            <h4>Аудио</h4>
            <br>
            <div class="grid">
                <div class="form-group">
                    <label>Фоновая музыка (BGM)</label>
                    <div class="audio-control-wrapper">
                        <select class="bgm-select">
                            <option value="">-- Не менять --</option>
                            <option value="stop">-- Остановить музыку --</option>
                        </select>
                        <button type="button" class="btn audio-preview-btn" data-type="bgm">▶</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Звуковой эффект (SFX)</label>
                    <div class="audio-control-wrapper">
                        <select class="sfx-select">
                            <option value="">-- Нет --</option>
                        </select>
                        <button type="button" class="btn audio-preview-btn" data-type="bgm">▶</button>
                    </div>
                </div>
            </div>

            <h4>Выборы (если есть)</h4>
            <div class="choices-container"></div>
            <button class="btn btn--small btn--secondary add-choice-btn">Добавить выбор</button>
        </div>
    </template>

    <template id="choice-row-template">
        <div class="choice-row" style="display: flex; gap: 10px; align-items: center; margin-bottom: 5px;">
            <div style="flex-grow: 1; display: flex; flex-direction: column; gap: 5px;">
                <input type="text" class="choice-text-input" placeholder="Текст выбора">
                <div style="display: flex; gap: 10px;">
                    <input type="text" class="choice-condition-input" placeholder="Условие (например, has_key == true)" style="width: 50%;">
                    <input type="text" class="choice-set-input" placeholder="Переменные (например, trust=+1, key=false)" style="width: 50%;">
                </div>
            </div>
            <select class="choice-next-select" style="width: 200px;"></select>
            <span class="remove-btn" title="Удалить выбор">✖</span>
        </div>
    </template>

    <template id="character-slot-template">
        <div class="character-slot">
            <div class="character-slot-header">
                <div class="character-slot-left">
                    <div class="position-controls">
                        <button class="btn btn--small btn--secondary move-up-btn" type="button" title="Переместить вверх">↑</button>
                        <button class="btn btn--small btn--secondary move-down-btn" type="button" title="Переместить вниз">↓</button>
                    </div>
                    <span class="character-slot-title">Персонаж <span class="slot-number">1</span></span>
                </div>
                <button class="btn btn--danger btn--small remove-character-btn" type="button">Удалить</button>
            </div>
            <div class="character-slot-content">
                <div class="form-group">
                    <label>Персонаж</label>
                    <select class="character-select"><option value="">-- Нет --</option></select>
                </div>
                <div class="form-group">
                    <label>Поза</label>
                    <select class="pose-select"></select>
                </div>
            </div>
        </div>
    </template>

    <script id="characters-data" type="application/json">
        {{ characters_json|safe }}
    </script>
    <script id="scenes-data" type="application/json">
        {{ scenes_json|safe }}
    </script>
    <script id="bgm-data" type="application/json">
        {{ bgm_json|safe }}
    </script>
    <script id="sfx-data" type="application/json">
        {{ sfx_json|safe }}
    </script>
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/scenario_creator.js') }}"></script>
</body>
</html>
